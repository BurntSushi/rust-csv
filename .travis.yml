language: rust
rust:
  - "nightly"
  - "beta"
env:
  - FEATURES="serde" TEST_FEATURES="serde-test"
  - FEATURES="rustc-serialize" TEST_FEATURES="rustc-serialize"
matrix:
  exclude:
    - rust: beta
      env: FEATURES="serde" TEST_FEATURES="serde-test"
script:
  - cargo build --verbose --no-default-features --features $FEATURES
  - cargo test --verbose --no-default-features --features $TEST_FEATURES --lib --test tests
  - if [[ $FEATURES == "rustc-serialize" ]]; then
      cargo test --verbose --no-default-features --features $TEST_FEATURES --doc;
    fi
  - if [[ $TRAVIS_RUST_VERSION == "nightly" ]]; then
      cargo bench --verbose --no-default-features --features $TEST_FEATURES;
    fi
